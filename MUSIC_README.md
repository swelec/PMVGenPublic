# Music Guided Generator

Скрипт `music_guided_generator.py` подготавливает музыкальные проекты,
по которым основной компилятор сможет синхронизировать видеонарезки
под ритм и динамику трека.

## Требования

- Python 3.10+
- Пакеты: `librosa`, `numpy` (установка: `pip install librosa numpy`)

## Что делает скрипт

1. Загружает указанный MP3.
2. Анализирует темп, биты, относительную громкость.
3. Генерирует таймкоды сегментов (`start/end/intensity`) и нормализует их.
4. Создаёт папку `music_projects/<slug>/`, куда копирует MP3, кладёт
   `manifest.json` и `timecodes.txt`.
5. В манифест записывает все данные для дальнейшей интеграции с основным
   скриптом (темп, список сегментов, относительную интенсивность и т.п.).

## Запуск

### Интерактивный режим (рекомендуется)

```bash
python music_guided_generator.py
```

Дальше скрипт сам спросит:

1. Скрипт автоматически смотрит папку `Music/` рядом с проектом и выводит список всех аудиофайлов (`.mp3/.wav/.flac/.m4a`). Нужно выбрать номер.
2. Далее можно указать имя проекта (по умолчанию используется имя файла).
3. Минимальную длительность сегмента, сек. Чем больше значение — тем реже появятся таймкоды (по умолчанию 3.0).
4. Алгоритм сегментации: `beat`, `onset`, `uniform`. Это позволяет быстро тестировать разные схемы выделения ритма.

После обработки вы увидите, где лежат:

- локальная копия MP3 (`music_projects/<slug>/audio.mp3`);
- JSON-манифест (`music_projects/<slug>/manifest.json`);
- таймкоды (`music_projects/<slug>/timecodes.txt`).

### Режим командной строки

Интерактивный режим доступен по умолчанию, но можно вызывать те же
операции как команду:

```bash
python music_guided_generator.py analyze path/to/song.mp3 --name "Demo" --segment 2.5
```

Аргументы аналогичны вопросам в интерактивном режиме (значение `--segment` задаёт минимальную длительность сегмента, `--mode` позволяет выбрать алгоритм, а `mp3` указывает путь явно — этот режим можно использовать, если не хочется класть файл в `Music/`).

## Формат манифеста

`manifest.json` содержит:

- `name`, `slug`, `audio_path`, `created_at` — описание проекта;
- `analysis.sample_rate`, `tempo`, `beat_times`, `beat_intensity`, `rms_curve`, `mode`;
- `analysis.segments` — список объектов `{start, end, duration, intensity}`.

По этим данным основной скрипт сможет:

1. Использовать точные таймкоды для постановки клипов.
2. Подобрать длину и скорость смены видео в зависимости от интенсивности.
3. Подмешать музыку (`audio.mp3`) поверх финальной компиляции.

## Дальнейшая интеграция

Следующим шагом основной генератор (main.py) может:

1. Импортировать `ProjectManifest` / `MusicAnalysis` из нового скрипта.
2. Прочитать манифест нужного проекта.
3. Нарезать исходники в соответствии с `analysis.segments` и наложить музыку.

Пока эти шаги не реализованы, музыкальные проекты можно готовить отдельно,
а затем использовать в основной логике вручную.
