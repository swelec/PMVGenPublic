# PMVGenPublic — Telegram бот для генерации PMV

Этот проект — локальный Telegram-бот, который сканирует папки с исходниками,
ведёт базу, умеет собирать PMV (обычные и под музыку), оценивать и
комментировать исходники, а также делать пачку генераций по правилам.

## Запуск на своём компьютере (без Docker)

1. Установите Python 3.10+.
2. Создайте виртуальное окружение и поставьте зависимости:
   ```powershell
   python -m venv .venv
   .\.venv\Scripts\Activate.ps1
   pip install -r requirements.txt
   ```
3. Скопируйте `private_settings.example.py` в `private_settings.py` и заполните:
   - `TELEGRAM_BOT_TOKEN`
   - `ALLOWED_USER_ID` (ваш Telegram user id)
   - Опционально: настройки сети/хранилища (см. файл-образец).
4. Запустите бота:
   ```powershell
   python main.py
   ```

Бот использует `ffmpeg.exe` и `ffprobe.exe` рядом со скриптом. Если их нет,
скрипт попытается скачать их автоматически.

## Минимум для старта (обязательно)

Порядок действий:

1. Добавьте в папку `Music/` минимум 10 треков (MP3/FLAC/M4A/WAV).
2. В боте выполните `/addfolder <путь>` для папок с видео.
3. Запустите `/scan` и дождитесь окончания. Сканирование может быть долгим:
   у автора ~12k файлов сканируются около 30 минут.
4. Запустите `/createrandompmv` и выберите любые параметры — бот всё сделает сам.

## Папки и данные

- `Music/` — музыкальные треки для `/musicprep`.
- `music_projects/` — проекты, которые создаёт `music_guided_generator.py`.
- `output/` — готовые PMV.
- `pmv_bot.db` — база данных (SQLite), создаётся автоматически.

## Команды бота

Список команд можно увидеть через `/start`. Кратко:

- `/start` — справка и список команд.
- `/addfolder <путь>` — добавить папку с исходниками для сканирования.
- `/folders` — показать добавленные папки и игнорируемые подпапки.
- `/scan` — сканировать папки и обновить базу исходников.
- `/scanignore` — добавить подпапку в игнор-лист для `/scan`.

- `/pmvnew` — создать PMV только из ещё не использованных исходников.
- `/pmvold` — создать PMV из любых исходников (включая использованные).
- `/autocreate` — автоматически создать серию PMV по параметрам.
- `/newcompmusic` — собрать PMV под музыку из `music_projects`.
- `/createrandompmv` — пакетная генерация Random PMV под музыку.

- `/musicprep` — разобрать трек из `Music/` и создать проект.
- `/musicprepcheck` — создать MP3 со щелчками для проверки сегментов.

- `/ratepmv` — оценить готовые PMV и (при желании) клипы внутри.
- `/rategrp` — оценка исходников в группе цветами.
- `/reports` — отчёты по цветам/группам.
- `/find` — поиск PMV и исходников по части имени/даты/времени.

- `/compmv` — добавить комментарий к PMV.
- `/comvid` — добавить комментарий к исходнику.
- `/lookcom` — показать все комментарии.

- `/badfiles` — список проблемных исходников.
- `/strategy [name]` — посмотреть/изменить стратегию выбора групп.
- `/videofx` — настроить эффекты (глитчи/переходы).
- `/move2oculus` — синхронизировать output на Oculus через ADB.

## Минимальный сценарий работы

1. `/addfolder` — добавьте папку(и) с исходниками.
2. `/scan` — проиндексируйте исходники.
3. Добавьте не менее 10 треков в `Music/`.
4. Запустите `/createrandompmv` — бот сам пройдёт все этапы и создаст PMV.
5. Дополнительно: `/pmvnew` или `/pmvold`, `/rategrp`, `/ratepmv`.
